<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chương 6 Biến đổi dữ liệu bằng thư viện \(dplyr\) | index</title>
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Chương 6 Biến đổi dữ liệu bằng thư viện \(dplyr\) | index">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chương 6 Biến đổi dữ liệu bằng thư viện \(dplyr\) | index">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Roboto-0.4.2/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><script src="libs/d3-bundle-5.16.0/d3-bundle.min.js"></script><script src="libs/d3-lasso-0.0.5/d3-lasso.min.js"></script><script src="libs/save-svg-as-png-1.4.17/save-svg-as-png.min.js"></script><script src="libs/flatbush-4.0.0/flatbush.min.js"></script><link href="libs/ggiraphjs-0.4.6/ggiraphjs.min.css" rel="stylesheet">
<script src="libs/ggiraphjs-0.4.6/ggiraphjs.min.js"></script><script src="libs/girafe-binding-0.8.8/girafe.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="Dữ liệu trước khi đưa vào trực quan hóa hoặc xây dựng mô hình hiếm khi có được định dạng chính xác mà bạn đọc mong muốn. Thông thường, bạn đọc sẽ cần tạo thêm một số biến, hoặc có thể bạn đọc chỉ...">
<meta property="og:description" content="Dữ liệu trước khi đưa vào trực quan hóa hoặc xây dựng mô hình hiếm khi có được định dạng chính xác mà bạn đọc mong muốn. Thông thường, bạn đọc sẽ cần tạo thêm một số biến, hoặc có thể bạn đọc chỉ...">
<meta name="twitter:description" content="Dữ liệu trước khi đưa vào trực quan hóa hoặc xây dựng mô hình hiếm khi có được định dạng chính xác mà bạn đọc mong muốn. Thông thường, bạn đọc sẽ cần tạo thêm một số biến, hoặc có thể bạn đọc chỉ...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Kiến thức R cơ bản</a></li>
<li><a class="" href="ma-tr%E1%BA%ADn-m%E1%BA%A3ng-nhi%E1%BB%81u-chi%E1%BB%81u-v%C3%A0-list.html"><span class="header-section-number">2</span> Ma trận, mảng nhiều chiều và \(list\)</a></li>
<li><a class="" href="ph%C3%A2n-t%C3%ADch-d%E1%BB%AF-li%E1%BB%87u-b%E1%BA%B1ng-r.html"><span class="header-section-number">3</span> Phân tích dữ liệu bằng R</a></li>
<li><a class="" href="nh%E1%BA%ADp-d%E1%BB%AF-li%E1%BB%87u-t%E1%BB%AB-c%C3%A1c-ngu%E1%BB%93n-kh%C3%A1c-nhau-v%C3%A0o-r.html"><span class="header-section-number">4</span> Nhập dữ liệu từ các nguồn khác nhau vào R</a></li>
<li><a class="" href="ti%E1%BB%81n-x%E1%BB%AD-l%C3%BD-d%E1%BB%AF-li%E1%BB%87u.html"><span class="header-section-number">5</span> Tiền xử lý dữ liệu</a></li>
<li><a class="active" href="bi%E1%BA%BFn-%C4%91%E1%BB%95i-d%E1%BB%AF-li%E1%BB%87u-b%E1%BA%B1ng-th%C6%B0-vi%E1%BB%87n-dplyr.html"><span class="header-section-number">6</span> Biến đổi dữ liệu bằng thư viện \(dplyr\)</a></li>
<li><a class="" href="tr%E1%BB%B1c-quan-h%C3%B3a-d%E1%BB%AF-li%E1%BB%87u.html"><span class="header-section-number">7</span> Trực quan hóa dữ liệu</a></li>
<li><a class="" href="tr%E1%BB%B1c-quan-h%C3%B3a-d%E1%BB%AF-li%E1%BB%87u-1.html"><span class="header-section-number">8</span> Trực quan hóa dữ liệu</a></li>
<li><a class="" href="m%C3%B4-h%C3%ACnh-h%E1%BB%93i-quy-tuy%E1%BA%BFn-t%C3%ADnh.html"><span class="header-section-number">9</span> Mô hình hồi quy tuyến tính</a></li>
<li><a class="" href="m%C3%B4-h%C3%ACnh-tuy%E1%BA%BFn-t%C3%ADnh-t%E1%BB%95ng-qu%C3%A1t..html"><span class="header-section-number">10</span> Mô hình tuyến tính tổng quát.</a></li>
<li><a class="" href="reference.html"><span class="header-section-number">11</span> REFERENCE</a></li>
<li><a class="" href="m%C3%B4-h%C3%ACnh-d%E1%BA%A1ng-c%C3%A2y.html"><span class="header-section-number">12</span> Mô hình dạng cây</a></li>
<li><a class="" href="m%C3%B4-h%C3%ACnh-m%E1%BA%A1ng-neural-network.html"><span class="header-section-number">13</span> Mô hình mạng neural network</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/dgrtwo/tidy-text-mining">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="biến-đổi-dữ-liệu-bằng-thư-viện-dplyr" class="section level1" number="6">
<h1>
<span class="header-section-number">Chương 6</span> Biến đổi dữ liệu bằng thư viện <span class="math inline">\(dplyr\)</span><a class="anchor" aria-label="anchor" href="#bi%E1%BA%BFn-%C4%91%E1%BB%95i-d%E1%BB%AF-li%E1%BB%87u-b%E1%BA%B1ng-th%C6%B0-vi%E1%BB%87n-dplyr"><i class="fas fa-link"></i></a>
</h1>
<p>Dữ liệu trước khi đưa vào trực quan hóa hoặc xây dựng mô hình hiếm khi có được định dạng chính xác mà bạn đọc mong muốn. Thông thường, bạn đọc sẽ cần tạo thêm một số biến, hoặc có thể bạn đọc chỉ muốn đổi tên các biến, hoặc sắp xếp lại các quan sát, hoặc tổng hợp dữ liệu để làm cho dữ liệu dễ dàng xử lý tiếp. Bạn đọc sẽ học cách thực hiện tất cả những phép biến đổi đó trong phần này. Nội dung chủ yếu của phần này sẽ hướng dẫn bạn đọc cách chuyển đổi dữ liệu của mình bằng cách sử dụng thư viện <span class="math inline">\(dplyr\)</span> và tập dữ liệu <span class="math inline">\(gapminder\)</span> - dữ liệu về sức khỏe và thu nhập của các quốc gia trên thế giới từ năm 1960 đến năm 2016.</p>
<p>Thư viện <span class="math inline">\(dplyr\)</span> là một thư viện nằm trong thư viện tổng hợp <span class="math inline">\(tidyverse\)</span>, bạn đọc có thể gọi thư viện <span class="math inline">\(tidyverse\)</span> hoặc trực tiếp thư viện <span class="math inline">\(dplyr\)</span> lên cửa sổ đang làm việc. Bạn đọc cũng nên lưu ý rằng trong thư viện <span class="math inline">\(dplyr\)</span> có một số hàm trùng tên với các hàm có sẵn trong R, chẳng hạn như hàm <span class="math inline">\(filter()\)</span> hoặc hàm <span class="math inline">\(lag()\)</span>. Tuy nhiên R ưu tiên <span class="math inline">\(dplyr\)</span> trước các thư viện có sẵn nên bạn đọc sẽ nhận được thông báo khi gọi thư viện này.</p>
<p>Dữ liệu <span class="math inline">\(gapminder\)</span> là dữ liệu đã được sử dụng trong phần tiền xử lý dữ liệu. Bạn đọc lưu ý thực hiện các bước tiền xử lý dữ liệu trước khi chạy các câu lệnh biến đổi dữ liệu. Mỗi phần tiếp theo sẽ giới thiệu một hàm quan trọng của thư viện <span class="math inline">\(dplyr\)</span> và các tham số của hàm đó. Sau cùng chúng tôi sẽ giới thiệu về cách sử dụng pipe (<span class="math inline">\(%\&gt;\%\)</span>) để kết nối các hàm với nhau trong một câu lệnh duy nhất.</p>
<div id="thêm-biến-bằng-hàm-mutate" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Thêm biến bằng hàm <span class="math inline">\(mutate()\)</span><a class="anchor" aria-label="anchor" href="#th%C3%AAm-bi%E1%BA%BFn-b%E1%BA%B1ng-h%C3%A0m-mutate"><i class="fas fa-link"></i></a>
</h2>
<p>Khi bạn đọc muốn thêm các cột khác vào một dữ liệu được tính toán từ các cột hiện có, bạn đọc có thể sử dụng hàm <span class="math inline">\(mutate()\)</span>. Hàm <span class="math inline">\(mutate()\)</span> luôn thêm cột vào sau cột cuối cùng trong dữ liệu hiện có. Khi bạn muốn thêm cột vào một vị trí cụ thể, bạn có thể sử dụng tùy biến</p>
<ul>
<li>
<span class="math inline">\(.after = ten\_cot\)</span> trong đó <span class="math inline">\(ten\_cot\)</span> là tên cột phía trước cột mà bạn đọc muốn thêm vào.</li>
<li>
<span class="math inline">\(.before = ten\_cot\)</span> trong đó <span class="math inline">\(ten\_cot\)</span> là tên cột phía sau cột mà bạn đọc muốn thêm vào.</li>
</ul>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytib</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">as.tibble</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># mytib là dữ liệu kiểu tibble</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">mytib</span>, gdp_per_capita <span class="op">=</span> <span class="va">gdp</span><span class="op">/</span><span class="va">population</span><span class="op">)</span> <span class="co"># thêm cột có tên là gdp_per_capita</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 10
##    country  year infan…¹ life_…² ferti…³ popul…⁴      gdp conti…⁵ region gdp_p…⁶
##    &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt;    &lt;dbl&gt;
##  1 Albania  1960   115.     62.9    6.19  1.64e6 NA       Europe  South…     NA 
##  2 Algeria  1960   148.     47.5    7.65  1.11e7  1.38e10 Africa  North…   1243.
##  3 Angola   1960   208      36.0    7.32  5.27e6 NA       Africa  Middl…     NA 
##  4 Antigu…  1960    NA      63.0    4.43  5.47e4 NA       Americ… Carib…     NA 
##  5 Argent…  1960    59.9    65.4    3.11  2.06e7  1.08e11 Americ… South…   5254.
##  6 Armenia  1960    NA      66.9    4.55  1.87e6 NA       Asia    Weste…     NA 
##  7 Aruba    1960    NA      65.7    4.82  5.42e4 NA       Americ… Carib…     NA 
##  8 Austra…  1960    20.3    70.9    3.45  1.03e7  9.67e10 Oceania Austr…   9393.
##  9 Austria  1960    37.3    68.8    2.7   7.07e6  5.24e10 Europe  Weste…   7415.
## 10 Azerba…  1960    NA      61.3    5.57  3.90e6 NA       Asia    Weste…     NA 
## # … with 10,535 more rows, and abbreviated variable names ¹​infant_mortality,
## #   ²​life_expectancy, ³​fertility, ⁴​population, ⁵​continent, ⁶​gdp_per_capita</code></pre>
<p>Câu lệnh trên thêm cột có tên là <span class="math inline">\(gdp\_per\_capita\)</span> được tính bằng tổng thu nhập quốc nội (<span class="math inline">\(gdp\)</span>) chia cho dân số của quốc gia đó. Nếu bạn đọc muốn cột mới được thêm vào ngay sau cột <span class="math inline">\(gdp\)</span>, hãy sử dụng thêm tùy biến <span class="math inline">\(.after\)</span></p>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">mytib</span>, gdp_per_capita <span class="op">=</span> <span class="va">gdp</span><span class="op">/</span><span class="va">population</span>,.after <span class="op">=</span> <span class="va">gdp</span><span class="op">)</span> <span class="co"># thêm cột có tên là gdp_per_capita</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 10
##    country  year infan…¹ life_…² ferti…³ popul…⁴      gdp gdp_p…⁵ conti…⁶ region
##    &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt; 
##  1 Albania  1960   115.     62.9    6.19  1.64e6 NA           NA  Europe  South…
##  2 Algeria  1960   148.     47.5    7.65  1.11e7  1.38e10   1243. Africa  North…
##  3 Angola   1960   208      36.0    7.32  5.27e6 NA           NA  Africa  Middl…
##  4 Antigu…  1960    NA      63.0    4.43  5.47e4 NA           NA  Americ… Carib…
##  5 Argent…  1960    59.9    65.4    3.11  2.06e7  1.08e11   5254. Americ… South…
##  6 Armenia  1960    NA      66.9    4.55  1.87e6 NA           NA  Asia    Weste…
##  7 Aruba    1960    NA      65.7    4.82  5.42e4 NA           NA  Americ… Carib…
##  8 Austra…  1960    20.3    70.9    3.45  1.03e7  9.67e10   9393. Oceania Austr…
##  9 Austria  1960    37.3    68.8    2.7   7.07e6  5.24e10   7415. Europe  Weste…
## 10 Azerba…  1960    NA      61.3    5.57  3.90e6 NA           NA  Asia    Weste…
## # … with 10,535 more rows, and abbreviated variable names ¹​infant_mortality,
## #   ²​life_expectancy, ³​fertility, ⁴​population, ⁵​gdp_per_capita, ⁶​continent</code></pre>
<p>Một biến thể khác của hàm <span class="math inline">\(mutate()\)</span> là <span class="math inline">\(transmute()\)</span>. Hàm <span class="math inline">\(transmute()\)</span> khác <span class="math inline">\(mutate()\)</span> ở chỗ là chỉ giữ lại các cột mới được tạo thành</p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">mytib</span>, gdp_per_capita <span class="op">=</span> <span class="va">gdp</span><span class="op">/</span><span class="va">population</span><span class="op">)</span> <span class="co"># data mới chỉ có cột gdp_per_capita</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 1
##    gdp_per_capita
##             &lt;dbl&gt;
##  1            NA 
##  2          1243.
##  3            NA 
##  4            NA 
##  5          5254.
##  6            NA 
##  7            NA 
##  8          9393.
##  9          7415.
## 10            NA 
## # … with 10,535 more rows</code></pre>
</div>
<div id="lựa-chọn-cột-bằng-hàm-select" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Lựa chọn cột bằng hàm <span class="math inline">\(select()\)</span><a class="anchor" aria-label="anchor" href="#l%E1%BB%B1a-ch%E1%BB%8Dn-c%E1%BB%99t-b%E1%BA%B1ng-h%C3%A0m-select"><i class="fas fa-link"></i></a>
</h2>
<p>Khi dữ liệu có quá nhiều cột và bạn đọc chỉ muốn sử dụng một số cột nhất định để phân tích, bạn đọc hãy sửa dụng hàm <span class="math inline">\(select()\)</span>. Điều quan trọng nhất khi sử dụng hàm <span class="math inline">\(select()\)</span> là bạn đọc cần phải gọi tên đúng các cột (biến) mà mình muốn lựa chọn.</p>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mytib</span>, <span class="va">year</span>, <span class="va">gdp</span>, <span class="va">population</span><span class="op">)</span> <span class="co"># lấy ra các cột year, gdp, population</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 3
##     year          gdp population
##    &lt;int&gt;        &lt;dbl&gt;      &lt;dbl&gt;
##  1  1960           NA    1636054
##  2  1960  13828152297   11124892
##  3  1960           NA    5270844
##  4  1960           NA      54681
##  5  1960 108322326649   20619075
##  6  1960           NA    1867396
##  7  1960           NA      54208
##  8  1960  96677859364   10292328
##  9  1960  52392699681    7065525
## 10  1960           NA    3897889
## # … with 10,535 more rows</code></pre>
<p>Hàm <span class="math inline">\(select\)</span> cũng có thể được sử dụng để thay đổi tên cột. Chẳng hạn bạn đọc muốn tên các cột mới tương ứng là <span class="math inline">\("Year"\)</span>, <span class="math inline">\("GDP"\)</span> và <span class="math inline">\("Population"\)</span></p>
<div class="sourceCode" id="cb530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mytib</span>, Year <span class="op">=</span> <span class="va">year</span>, Gdp <span class="op">=</span>  <span class="va">gdp</span>,  Population <span class="op">=</span> <span class="va">population</span><span class="op">)</span> <span class="co"># lấy ra và đổi tên các cột year, gdp, population</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 3
##     Year          Gdp Population
##    &lt;int&gt;        &lt;dbl&gt;      &lt;dbl&gt;
##  1  1960           NA    1636054
##  2  1960  13828152297   11124892
##  3  1960           NA    5270844
##  4  1960           NA      54681
##  5  1960 108322326649   20619075
##  6  1960           NA    1867396
##  7  1960           NA      54208
##  8  1960  96677859364   10292328
##  9  1960  52392699681    7065525
## 10  1960           NA    3897889
## # … with 10,535 more rows</code></pre>
<p>Khi dữ liệu có quá nhiều cột và việc gọi tên chính xác các cột làm cho câu lệnh <span class="math inline">\(select()\)</span> quá dài, bạn đọc có thể lựa chọn các cột đứng liền nhau bằng cách sau</p>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mytib</span>, <span class="va">year</span>, <span class="va">gdp</span><span class="op">:</span><span class="va">population</span><span class="op">)</span> <span class="co"># </span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 3
##     year          gdp population
##    &lt;int&gt;        &lt;dbl&gt;      &lt;dbl&gt;
##  1  1960           NA    1636054
##  2  1960  13828152297   11124892
##  3  1960           NA    5270844
##  4  1960           NA      54681
##  5  1960 108322326649   20619075
##  6  1960           NA    1867396
##  7  1960           NA      54208
##  8  1960  96677859364   10292328
##  9  1960  52392699681    7065525
## 10  1960           NA    3897889
## # … with 10,535 more rows</code></pre>
<p>Câu lệnh trên có ý nghĩa là lấy ra cột <span class="math inline">\(year\)</span> và tất cả các cột nằm giữa cột <span class="math inline">\(gdp\)</span> và cột <span class="math inline">\(population\)</span>.</p>
<p>Bạn đọc không nhớ chính xác tên cột muốn lấy ra thì có thể sử dụng các tùy chọn sau:</p>
<ul>
<li><p><span class="math inline">\(starts\_with()\)</span>: lấy ra các cột có tên bắt đầu bằng một chuỗi ký tự nào đó.</p></li>
<li><p><span class="math inline">\(ends\_with()\)</span>: lấy ra các cột có tên kết thúc bằng một chuỗi ký tự nào đó.</p></li>
<li><p><span class="math inline">\(contains()\)</span>: lấy ra các cột có tên chứa một chuỗi ký tự nào đó.</p></li>
<li><p><span class="math inline">\(matches()\)</span>: lấy ra các cột có tên khớp với một xxxxxxxxxxxxxxxxxxx nào đó</p></li>
</ul>
<div class="sourceCode" id="cb534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytib1</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">mytib</span>, gdp_per_capita <span class="op">=</span> <span class="va">gdp</span><span class="op">/</span><span class="va">population</span><span class="op">)</span> <span class="co"># mytib1 là tibble có thêm cột tên là gdp_per_capita</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mytib1</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"gdp"</span><span class="op">)</span><span class="op">)</span> <span class="co"># lấy ra tất cả các cột có tên chứa "gdp"</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 2
##             gdp gdp_per_capita
##           &lt;dbl&gt;          &lt;dbl&gt;
##  1           NA            NA 
##  2  13828152297          1243.
##  3           NA            NA 
##  4           NA            NA 
##  5 108322326649          5254.
##  6           NA            NA 
##  7           NA            NA 
##  8  96677859364          9393.
##  9  52392699681          7415.
## 10           NA            NA 
## # … with 10,535 more rows</code></pre>
<p>Hàm <span class="math inline">\(select()\)</span> ngoài ý nghĩa là lựa chọn cột còn có ý nghĩa là loại bỏ một số cột nào đó khỏi dữ liệu hiện thời. Để loại bỏ cột, bạn đọc chỉ cần thêm dấu “-” vào trước tên cột.</p>
<div class="sourceCode" id="cb536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mytib1</span>, <span class="op">-</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"gdp"</span><span class="op">)</span><span class="op">)</span> <span class="co"># bỏ đi tất cả các cột có tên chứa "gdp"</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 8
##    country              year infant_mor…¹ life_…² ferti…³ popul…⁴ conti…⁵ region
##    &lt;fct&gt;               &lt;int&gt;        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt; 
##  1 Albania              1960        115.     62.9    6.19  1.64e6 Europe  South…
##  2 Algeria              1960        148.     47.5    7.65  1.11e7 Africa  North…
##  3 Angola               1960        208      36.0    7.32  5.27e6 Africa  Middl…
##  4 Antigua and Barbuda  1960         NA      63.0    4.43  5.47e4 Americ… Carib…
##  5 Argentina            1960         59.9    65.4    3.11  2.06e7 Americ… South…
##  6 Armenia              1960         NA      66.9    4.55  1.87e6 Asia    Weste…
##  7 Aruba                1960         NA      65.7    4.82  5.42e4 Americ… Carib…
##  8 Australia            1960         20.3    70.9    3.45  1.03e7 Oceania Austr…
##  9 Austria              1960         37.3    68.8    2.7   7.07e6 Europe  Weste…
## 10 Azerbaijan           1960         NA      61.3    5.57  3.90e6 Asia    Weste…
## # … with 10,535 more rows, and abbreviated variable names ¹​infant_mortality,
## #   ²​life_expectancy, ³​fertility, ⁴​population, ⁵​continent</code></pre>
</div>
<div id="lọc-quan-sát-bằng-hàm-filter" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Lọc quan sát bằng hàm <code>filter()</code><a class="anchor" aria-label="anchor" href="#l%E1%BB%8Dc-quan-s%C3%A1t-b%E1%BA%B1ng-h%C3%A0m-filter"><i class="fas fa-link"></i></a>
</h2>
<p>Hàm <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> cho phép bạn đọc lọc các quan sát dựa trên giá trị của các cột. Do có một số thư viện trong R sử dụng hàm <span class="math inline">\(filter()\)</span> với mục đích khác nhau và chúng tôi không chắc chắn cửa sổ R bạn đọc đang sử dụng đang có sẵn các thư viện nào nên chúng tôi đổi tên cho hàm <span class="math inline">\(filter()\)</span> của thư viện <span class="math inline">\(dplyr\)</span> thành <span class="math inline">\(dfilter()\)</span> phương pháp mượn tham số:</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfilter</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>Cách hoạt động của hàm <span class="math inline">\(filter()\)</span> như sau: bạn đọc muốn lấy dữ liệu của năm 2010 từ dữ liệu <span class="math inline">\(gapminder\)</span>, chúng ta sử dụng hàm <span class="math inline">\(filter()\)</span> như sau</p>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dfilter</span><span class="op">(</span><span class="va">mytib</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span><span class="op">)</span> <span class="co"># chỉ lấy các quan sát có year là 2010</span></span></code></pre></div>
<pre><code>## # A tibble: 185 × 9
##    country          year infan…¹ life_…² ferti…³ popul…⁴      gdp conti…⁵ region
##    &lt;fct&gt;           &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt; 
##  1 Albania          2010    14.8    77.2    1.74  2.90e6  6.14e 9 Europe  South…
##  2 Algeria          2010    23.5    76      2.82  3.60e7  7.92e10 Africa  North…
##  3 Angola           2010   110.     57.6    6.22  2.12e7  2.61e10 Africa  Middl…
##  4 Antigua and Ba…  2010     7.7    75.8    2.13  8.72e4  8.37e 8 Americ… Carib…
##  5 Argentina        2010    13      75.8    2.22  4.12e7  4.34e11 Americ… South…
##  6 Armenia          2010    16.1    73      1.55  2.96e6  4.10e 9 Asia    Weste…
##  7 Aruba            2010    NA      75.1    1.7   1.02e5 NA       Americ… Carib…
##  8 Australia        2010     4.1    82      1.89  2.22e7  5.63e11 Oceania Austr…
##  9 Austria          2010     3.6    80.5    1.44  8.39e6  2.24e11 Europe  Weste…
## 10 Azerbaijan       2010    33.9    70.1    1.97  9.10e6  2.12e10 Asia    Weste…
## # … with 175 more rows, and abbreviated variable names ¹​infant_mortality,
## #   ²​life_expectancy, ³​fertility, ⁴​population, ⁵​continent</code></pre>
<p>Sau khi chạy câu lệnh trên, R sẽ tạo thành một <span class="math inline">\(tibble()\)</span> mới chỉ bao gồm các quan sát có giá trị cột <span class="math inline">\(year\)</span> là 2010. Lưu ý rằng nếu bạn đọc muốn lưu lại giá trị sau mỗi lần thực hiện tính toán hãy gán giá trị trả lại vào một đối tượng mới. <span class="math inline">\(filter()\)</span> có thể được thực hiện khi sử dụng nhiều cột, chẳng hạn như bạn đọc muốn lọc các quan sát của năm 2010 của các quốc gia Châu Âu</p>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dfilter</span><span class="op">(</span><span class="va">mytib</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span>, <span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## # A tibble: 39 × 9
##    country           year infan…¹ life_…² ferti…³ popul…⁴     gdp conti…⁵ region
##    &lt;fct&gt;            &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt; 
##  1 Albania           2010    14.8    77.2    1.74  2.90e6 6.14e 9 Europe  South…
##  2 Austria           2010     3.6    80.5    1.44  8.39e6 2.24e11 Europe  Weste…
##  3 Belarus           2010     4.7    70.2    1.46  9.49e6 2.60e10 Europe  Easte…
##  4 Belgium           2010     3.6    80.1    1.84  1.09e7 2.67e11 Europe  Weste…
##  5 Bosnia and Herz…  2010     6.4    77.9    1.24  3.84e6 8.21e 9 Europe  South…
##  6 Bulgaria          2010    11.2    73.7    1.49  7.41e6 1.92e10 Europe  Easte…
##  7 Croatia           2010     4.6    76.7    1.47  4.32e6 2.80e10 Europe  South…
##  8 Czech Republic    2010     3.4    77.5    1.5   1.05e7 8.21e10 Europe  Easte…
##  9 Denmark           2010     3.3    79.4    1.88  5.55e6 1.69e11 Europe  North…
## 10 Estonia           2010     3.6    76.4    1.63  1.33e6 8.01e 9 Europe  North…
## # … with 29 more rows, and abbreviated variable names ¹​infant_mortality,
## #   ²​life_expectancy, ³​fertility, ⁴​population, ⁵​continent</code></pre>
</div>
<div id="sắp-xếp-dữ-liệu-bằng-hàm-arrange" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Sắp xếp dữ liệu bằng hàm <code>arrange()</code><a class="anchor" aria-label="anchor" href="#s%E1%BA%AFp-x%E1%BA%BFp-d%E1%BB%AF-li%E1%BB%87u-b%E1%BA%B1ng-h%C3%A0m-arrange"><i class="fas fa-link"></i></a>
</h2>
<p>Hàm <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> sắp xếp các hàng của dữ liệu theo thứ tự tăng dần. Nguyên tắc sắp xếp cũng tương tự như hàm <code><a href="https://rdrr.io/r/base/sort.html">sort()</a></code> khi làm trên véc-tơ, nghĩa là hàm bạn đọc có thể sắp xếp dữ liệu dựa theo bất kỳ kiểu dữ liệu nào. Chẳng hạn như để sắp xếp dữ liệu <span class="math inline">\(gapminder\)</span> theo thứ tự tăng dần theo năm, theo Châu lục, và sau cùng là theo vùng, bạn đọc sử dụng câu lệnh như sau</p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mytib</span>, <span class="va">year</span>, <span class="va">continent</span>, <span class="va">region</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 9
##    country     year infant_mort…¹ life_…² ferti…³ popul…⁴     gdp conti…⁵ region
##    &lt;fct&gt;      &lt;int&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt; 
##  1 Burundi     1960         145.     40.6    6.95  2.79e6  3.41e8 Africa  Easte…
##  2 Comoros     1960         200      44.0    6.79  1.89e5 NA      Africa  Easte…
##  3 Djibouti    1960          NA      45.8    6.46  8.36e4 NA      Africa  Easte…
##  4 Eritrea     1960          NA      39.0    6.9   1.41e6 NA      Africa  Easte…
##  5 Ethiopia    1960         162      37.7    6.88  2.22e7 NA      Africa  Easte…
##  6 Kenya       1960         119.     47.4    7.95  8.11e6  2.12e9 Africa  Easte…
##  7 Madagascar  1960         112      42.0    7.3   5.10e6  2.09e9 Africa  Easte…
##  8 Malawi      1960         218.     38.5    6.91  3.62e6  3.48e8 Africa  Easte…
##  9 Mauritius   1960          67.8    58.7    6.17  6.60e5 NA      Africa  Easte…
## 10 Mozambique  1960         183      38.2    6.6   7.49e6 NA      Africa  Easte…
## # … with 10,535 more rows, and abbreviated variable names ¹​infant_mortality,
## #   ²​life_expectancy, ³​fertility, ⁴​population, ⁵​continent</code></pre>
<p>Nếu muốn sắp xếp dữ liệu theo thứ tự giảm dần, nếu cột dữ liệu là kiểu số, bạn đọc chỉ cần thêm dấu “-” trước tên biến. Trong trường hợp cột dữ liệu kiểu bất kỳ, bạn đọc sử dụng hàm <span class="math inline">\(desc()\)</span></p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mytib</span>, <span class="va">year</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>, <span class="op">-</span><span class="va">gdp</span><span class="op">)</span> <span class="co"># tăng dần theo năm, giảm dần theo continent, region, gdp</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 9
##    country           year infan…¹ life_…² ferti…³ popul…⁴     gdp conti…⁵ region
##    &lt;fct&gt;            &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt; 
##  1 French Polynesia  1960     NA     56.3    5.66   78083 NA      Oceania Polyn…
##  2 Samoa             1960     92     51.4    7.65  108645 NA      Oceania Polyn…
##  3 Tonga             1960     NA     61.2    7.36   61600 NA      Oceania Polyn…
##  4 Kiribati          1960     NA     45.8    6.95   41234 NA      Oceania Micro…
##  5 Micronesia, Fed…  1960     NA     56.8    6.93   44539 NA      Oceania Micro…
##  6 Papua New Guinea  1960    135.    38.6    6.28 1966957  8.37e8 Oceania Melan…
##  7 Fiji              1960     54     55.7    6.46  393383  4.37e8 Oceania Melan…
##  8 New Caledonia     1960     NA     56.4    5.22   78058 NA      Oceania Melan…
##  9 Solomon Islands   1960    132.    50.6    6.39  117869 NA      Oceania Melan…
## 10 Vanuatu           1960    107.    46.0    7.2    63701 NA      Oceania Melan…
## # … with 10,535 more rows, and abbreviated variable names ¹​infant_mortality,
## #   ²​life_expectancy, ³​fertility, ⁴​population, ⁵​continent</code></pre>
<p>Lưu ý rằng nếu trong cột dữ liệu sử dụng để sắp xếp có giá trị <span class="math inline">\(NA\)</span> thì các giá trị này luôn được sắp xếp xuống phía dưới của dữ liệu.</p>
</div>
<div id="kết-hợp-các-hàm-bằng-toán-tử-pipe" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Kết hợp các hàm bằng toán tử pipe (<code>\%&gt;\%</code>)<a class="anchor" aria-label="anchor" href="#k%E1%BA%BFt-h%E1%BB%A3p-c%C3%A1c-h%C3%A0m-b%E1%BA%B1ng-to%C3%A1n-t%E1%BB%AD-pipe"><i class="fas fa-link"></i></a>
</h2>
<p>Trước khi giới thiệu các hàm khác dùng để biến đổi dữ liệu của thư viện <span class="math inline">\(dplyr\)</span>, chúng tôi muốn giới thiệu đến bạn đọc toán tử pipe (<span class="math inline">\(\%&gt;\%\)</span>). Đây là một công cụ vô cùng hữu hiệu khi bạn đọc thực hiện một chuỗi các phép biến đổi dữ liệu. Toán tử pipe được mượn từ toán học khi nói đến việc sử dụng các hàm số nối tiếp nhau. Pipe trong thư viện <span class="math inline">\(dplyr\)</span> cũng có ý nghĩa tương tự khi bạn đọc sử dụng một chuỗi các hàm của thư viện này nhằm biến đổi dữ liệu. Ví dụ như khi bạn đọc muốn lấy ra từ dữ liệu <span class="math inline">\(gapminder\)</span> ba quốc gia có thu nhập bình quân đầu người cao nhất trong năm 2000, bạn sẽ cần các phép biến đổi sau:
- Thứ nhất: thêm cột thu nhập bình quân đầu người (sử dụng hàm <span class="math inline">\(mutate()\)</span>)
- Thứ hai: lọc dữ liệu theo năm, chỉ lấy dữ liệu của năm 2000. (sử dụng hàm <span class="math inline">\(filter()\)</span>)
- Thứ ba: lựa chọn cột tên quốc gia và cột thu nhập bình quân đầu người (sử dụng hàm <span class="math inline">\(select()\)</span>)
- Thứ tư: sắp xếp dữ liệu theo cột thu nhập bình quân đầu người, thứ tự sắp xếp là giảm dần (sử dụng hàm <span class="math inline">\(arrange()\)</span>)
- Thứ năm: lấy ra ba hàng đầu tiên của dữ liệu (sử dụng hàm <span class="math inline">\(head()\)</span>)</p>
<p>Nếu không sử dụng toán tử <span class="math inline">\(pipe\)</span>, sau mỗi bước ở trên bạn đọc sẽ phải lưu kết quả và gọi lại kết quả vào bước kế tiếp:</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytib1</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">mytib</span>,gdp_per_capita <span class="op">=</span> <span class="va">gdp</span><span class="op">/</span><span class="va">population</span><span class="op">)</span> <span class="co"># bước thứ nhất</span></span>
<span><span class="va">mytib1</span><span class="op">&lt;-</span><span class="fu">dfilter</span><span class="op">(</span><span class="va">mytib1</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span><span class="op">)</span> <span class="co"># bước thứ hai</span></span>
<span><span class="va">mytib1</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mytib1</span>, <span class="va">country</span>, <span class="va">gdp_per_capita</span><span class="op">)</span> <span class="co"># bước thứ ba</span></span>
<span><span class="va">mytib1</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mytib1</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">gdp_per_capita</span><span class="op">)</span><span class="op">)</span> <span class="co"># bước thứ tư</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mytib1</span>,<span class="fl">3</span><span class="op">)</span> <span class="co"># bước thứ năm</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   country    gdp_per_capita
##   &lt;fct&gt;               &lt;dbl&gt;
## 1 Luxembourg         52210.
## 2 Japan              40013.
## 3 Norway             39954.</code></pre>
<p>Thay vì phải lưu lại dữ liệu sau mỗi lần sử dụng biến đổi dữ liệu và gọi lại kết quả để sử dụng cho bước tiếp theo, bạn đọc có thể sử dụng toán tử <span class="math inline">\(pipe\)</span> như sau</p>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytib</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp_per_capita <span class="op">=</span> <span class="va">gdp</span><span class="op">/</span><span class="va">population</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dfilter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">gdp_per_capita</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">gdp_per_capita</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   country    gdp_per_capita
##   &lt;fct&gt;               &lt;dbl&gt;
## 1 Luxembourg         52210.
## 2 Japan              40013.
## 3 Norway             39954.</code></pre>
<p>Kết quả thu được hoàn toàn tương tự như trên tuy nhiên câu lệnh đã rõ ràng hơn rất nhiều. Từ phần này của cuốn sách, mọi phép biến đổi trên dữ liệu chúng tôi sẽ luôn luôn ưu tiên sử dụng toán tử <span class="math inline">\(pipe\)</span> vì sự đơn giản và rõ ràng của các câu lệnh.</p>
</div>
<div id="tổng-hợp-dữ-liệu-bằng-group_by-và-summarise" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> Tổng hợp dữ liệu bằng <span class="math inline">\(group\_by()\)</span> và <span class="math inline">\(summarise()\)</span><a class="anchor" aria-label="anchor" href="#t%E1%BB%95ng-h%E1%BB%A3p-d%E1%BB%AF-li%E1%BB%87u-b%E1%BA%B1ng-group_by-v%C3%A0-summarise"><i class="fas fa-link"></i></a>
</h2>
<p>Hàm <span class="math inline">\(group\_by()\)</span> là một công cụ hữu hiệu trong tổng hợp dữ liệu và tính toán theo nhóm. Chẳng hạn như từ dữ liệu <span class="math inline">\(gapminder\)</span> bạn đọc muốn biết tổng thu nhập quốc dân (<span class="math inline">\(gdp\)</span>) của một quốc gia là cao hay thấp so với tổng thu nhập quốc dân trung bình của châu lục (<span class="math inline">\(continent\)</span>) trong năm tương ứng (<span class="math inline">\(year\)</span>), bạn đọc cần phải thực hiện các thao tác sau:
- Bước 1: Nhóm dữ liệu lại theo châu lục và theo năm
- Bước 2: Tính tổng thu nhập quốc dân của châu lục trong năm đó, bỏ qua các nước không có quan sát
- Bước 3: Đếm xem có bao nhiêu giá trị có quan sát
- Bước 4: Lấy kết quả ở bước 2 chia cho kết quả của bước 3.
- Bước 5: So sánh gdp của quốc gia với gdp trung bình của châu lục trong năm đó</p>
<p>Những bước như trên có thể được thực hiện một cách đơn giản thông qua hàm <span class="math inline">\(group\_by\)</span> như sau</p>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytib</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp_year_continent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">gdp</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># thêm cột gdp bình quân của châu lục theo năm</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># để dữ liệu trở lại trạng thái ban đầu (trước khi group)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">gdp</span> <span class="op">&gt;</span> <span class="va">gdp_year_continent</span>, <span class="st">"High"</span>, <span class="st">"Low"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 10,545 × 11
##    country  year infan…¹ life_…² ferti…³ popul…⁴      gdp conti…⁵ region gdp_y…⁶
##    &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt;    &lt;dbl&gt;
##  1 Albania  1960   115.     62.9    6.19  1.64e6 NA       Europe  South… 1.11e11
##  2 Algeria  1960   148.     47.5    7.65  1.11e7  1.38e10 Africa  North… 3.65e 9
##  3 Angola   1960   208      36.0    7.32  5.27e6 NA       Africa  Middl… 3.65e 9
##  4 Antigu…  1960    NA      63.0    4.43  5.47e4 NA       Americ… Carib… 1.15e11
##  5 Argent…  1960    59.9    65.4    3.11  2.06e7  1.08e11 Americ… South… 1.15e11
##  6 Armenia  1960    NA      66.9    4.55  1.87e6 NA       Asia    Weste… 6.12e10
##  7 Aruba    1960    NA      65.7    4.82  5.42e4 NA       Americ… Carib… 1.15e11
##  8 Austra…  1960    20.3    70.9    3.45  1.03e7  9.67e10 Oceania Austr… 3.27e10
##  9 Austria  1960    37.3    68.8    2.7   7.07e6  5.24e10 Europe  Weste… 1.11e11
## 10 Azerba…  1960    NA      61.3    5.57  3.90e6 NA       Asia    Weste… 6.12e10
## # … with 10,535 more rows, 1 more variable: gdp_level &lt;chr&gt;, and abbreviated
## #   variable names ¹​infant_mortality, ²​life_expectancy, ³​fertility,
## #   ⁴​population, ⁵​continent, ⁶​gdp_year_continent</code></pre>
<p>Nếu đoạn câu lệnh trên không sử dụng câu lệnh <span class="math inline">\(group\_by\)</span>, hàm <span class="math inline">\(mean()\)</span> trong câu lệnh <span class="math inline">\(mutate()\)</span> sẽ thực hiên tính toán cho toàn bộ véc-tơ <span class="math inline">\(gdp\)</span> của dữ liệu <span class="math inline">\(gapminder\)</span>. Nghĩa là cột mới được hình thành sẽ có giá trị giống nhau với tất cả các quan sát. Sau khi sử dụng hàm <span class="math inline">\(group\_by()\)</span>, mỗi khi chúng ta sử dụng một hàm tính toán trên một cột dữ liệu khác, cột dữ liệu đó sẽ được tính toán cho từng nhóm được định nghĩa bởi hàm <span class="math inline">\(group\_by\)</span>. Trong đoạn lệnh ở trên, hàm <span class="math inline">\(mean()\)</span> sẽ tính giá trị trung bình của véc-tơ <span class="math inline">\(gdp\)</span> cho từng châu lục theo từng năm. Thật vậy, chúng ta có thể kiểm tra giá trị ở hàng đầu tiên của cột <span class="math inline">\(gdp\_year\_continent\)</span> (tương ứng với Albania - năm 1960 - châu Âu) sẽ là giá trị trung bình của véc-tơ <span class="math inline">\(gdp\)</span> của các nước châu Âu trong năm 1960:</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytib</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span><span class="fu">dfilter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1960</span>, <span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gdp</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Hàm <span class="math inline">\(group\_by()\)</span> kết hợp với <span class="math inline">\(summarise()\)</span> sẽ tạo thành một dữ liệu mới mà mỗi hàng sẽ tương đương với một nhóm được quy định bởi hàm <span class="math inline">\(group\_by()\)</span>.</p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytib</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>gdp_year_continent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">gdp</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 285 × 3
## # Groups:   continent [5]
##    continent  year gdp_year_continent
##    &lt;fct&gt;     &lt;int&gt;              &lt;dbl&gt;
##  1 Africa     1960        3652247577.
##  2 Africa     1961        3642863976.
##  3 Africa     1962        3781167783.
##  4 Africa     1963        4107185952.
##  5 Africa     1964        4342684293.
##  6 Africa     1965        4618242478.
##  7 Africa     1966        4562215808.
##  8 Africa     1967        4592913225.
##  9 Africa     1968        4814235499.
## 10 Africa     1969        5157970620.
## # … with 275 more rows</code></pre>
<p>Bạn đọc có thể thấy rằng dữ liệu mới (dưới dạng một <span class="math inline">\(tibble\)</span>) được tạo thành, mỗi hàng là một châu lục trong một năm, với ba cột bao gồm hai cột được quy định bởi hàm <span class="math inline">\(group\_by()\)</span> là <span class="math inline">\(continent\)</span>, <span class="math inline">\(year\)</span> và cột <span class="math inline">\(gdp\_year\_continent\)</span> mới được tạo thành từ hàm <span class="math inline">\(summarise()\)</span>.</p>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ti%E1%BB%81n-x%E1%BB%AD-l%C3%BD-d%E1%BB%AF-li%E1%BB%87u.html"><span class="header-section-number">5</span> Tiền xử lý dữ liệu</a></div>
<div class="next"><a href="tr%E1%BB%B1c-quan-h%C3%B3a-d%E1%BB%AF-li%E1%BB%87u.html"><span class="header-section-number">7</span> Trực quan hóa dữ liệu</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#bi%E1%BA%BFn-%C4%91%E1%BB%95i-d%E1%BB%AF-li%E1%BB%87u-b%E1%BA%B1ng-th%C6%B0-vi%E1%BB%87n-dplyr"><span class="header-section-number">6</span> Biến đổi dữ liệu bằng thư viện \(dplyr\)</a></li>
<li><a class="nav-link" href="#th%C3%AAm-bi%E1%BA%BFn-b%E1%BA%B1ng-h%C3%A0m-mutate"><span class="header-section-number">6.1</span> Thêm biến bằng hàm \(mutate()\)</a></li>
<li><a class="nav-link" href="#l%E1%BB%B1a-ch%E1%BB%8Dn-c%E1%BB%99t-b%E1%BA%B1ng-h%C3%A0m-select"><span class="header-section-number">6.2</span> Lựa chọn cột bằng hàm \(select()\)</a></li>
<li><a class="nav-link" href="#l%E1%BB%8Dc-quan-s%C3%A1t-b%E1%BA%B1ng-h%C3%A0m-filter"><span class="header-section-number">6.3</span> Lọc quan sát bằng hàm filter()</a></li>
<li><a class="nav-link" href="#s%E1%BA%AFp-x%E1%BA%BFp-d%E1%BB%AF-li%E1%BB%87u-b%E1%BA%B1ng-h%C3%A0m-arrange"><span class="header-section-number">6.4</span> Sắp xếp dữ liệu bằng hàm arrange()</a></li>
<li><a class="nav-link" href="#k%E1%BA%BFt-h%E1%BB%A3p-c%C3%A1c-h%C3%A0m-b%E1%BA%B1ng-to%C3%A1n-t%E1%BB%AD-pipe"><span class="header-section-number">6.5</span> Kết hợp các hàm bằng toán tử pipe (\%&gt;\%)</a></li>
<li><a class="nav-link" href="#t%E1%BB%95ng-h%E1%BB%A3p-d%E1%BB%AF-li%E1%BB%87u-b%E1%BA%B1ng-group_by-v%C3%A0-summarise"><span class="header-section-number">6.6</span> Tổng hợp dữ liệu bằng \(group\_by()\) và \(summarise()\)</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/dgrtwo/tidy-text-mining/blob/master/08-phan-tich-du-lieu-bang-R.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/dgrtwo/tidy-text-mining/edit/master/08-phan-tich-du-lieu-bang-R.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong></strong>" was written by . </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
